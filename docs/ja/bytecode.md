# Andesite VM Bytecode
- [Andesite VM Bytecode](#andesite-vm-bytecode)
  - [Header](#header)
  - [Offsets](#offsets)
  - [Sections](#sections)
  - [Constant Pools](#constant-pools)
  - [Imports](#imports)
  - [Defines](#defines)
  - [Init](#init)

## Header
- 先頭12バイトはヘッダーとして認識
- `[マジックナンバー][メジャーバージョン][マイナーバージョン]`
  - 例: `12 34 56 78` `00 00 00 01` `00 00 00 00`

## Offsets
- セクションがどこから始まっているかを表します。
- 4バイトで表され、Sectionsの上から下までの並びになっています。

## Sections
- `[セクションID(1バイト)][サイズ(4バイト)][エントリ数(4バイト)]`
  - 例: `01` `00 00 00 57` `00 00 00 0A`
- pool (0x01)
  - 定数プールです。プログラム内で使用されるあらゆる固定値が入っています。
  - 最大で65535つの定数が保存できます。
- imports (0x02)
  - プログラムが使用している外部の変数やクラスなどです。実行時に動的にインポートして使用します。
- defines (0x03)
  - クラスや関数など、あらゆる定義がここに入ります。
- init (0x04)
  - プログラム本体です。関数などを除くコードはすべてここに入ります。

## Constant Pools
- Tags
  - identifier(0x0F)
    - 識別子です。std.io.printlnなら、std, io, printlnと分けて格納されます。
  - reference(0x01)
    - 参照です。識別子や参照そのものを組み合わせて生成します。
  - string(0x02)
    - UTF8の文字列です。
  - unicode(0x03)
    - unicodeの文字列です。
  - bool(0x04)
    - 真偽値です。
  - char(0x05)
    - ASCIIのキャラクターです。
  - type(0x06)
    - 型名です。identifierから生成します。
  - i8(0x10)
    - 8bitの整数です。
  - i16(0x11)
    - 16bitの整数です。
  - i32(0x12)
    - 32bitの整数です。
  - i64(0x13)
    - 64bitの整数です。
  - f32(0x14)
    - 32bitの浮動小数点数です。
  - f64(0x15)
    - 64bitの浮動小数点数です。
  - u8(0x16)
    - 8bitの符号なし整数です。
  - u16(0x17)
    - 16bitの符号なし整数です。
  - u32(0x18)
    - 32bitの符号なし整数です。
  - u64(0x19)
    - 64bitの符号なし整数です。
- `[タグ(1バイト)][値のサイズ(4バイト)][値(可変)]`で表されます。

## Imports
- `[合計サイズ][エイリアス]#[ファイル名]$[クラス/関数名]`
  - 例: `standard#_GLOBAL$std`
    - _GLOBAL(グローバルライブラリ)から、stdをstandardとしてインポート

## Defines
- `[タグ(1バイト)][サイズ(4バイト)][中身(可変)]`
  - 例: `01` `00 00 00 11` `01 00 00 00 0C 00 0F 00 07 00 0F 00 02 00 08 00 13`
- Tags
  - function(0x01)
    - 関数です。
    - エントリ:
      - `[関数名(4バイト)][引数(可変)][引数の数(1バイト)][コードサイズ(4バイト)][コード(可変)]`
      - 例: `0B` `00 00 00 0A` `01` `00 00 00 0C` `00 0F 00 07 00 0F 00 02 00 08 00 13`
  - class(0x02)
    - クラスです。
  - interface(0x03)
    - インターフェースです。

## Init
- `[コードサイズ(4バイト)][コード(可変)]`
  - 例: `00 00 00 06` `00 05 00 0F 00 0A`